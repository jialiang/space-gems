(this.webpackJsonpgems=this.webpackJsonpgems||[]).push([[0],{16:function(e,t,n){},17:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n(6),o=(n(16),n(7)),c=n(8),s=n(1),i=n(10),u=n(9),l=n(4),d=n(3),m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.data;switch(t.type){case"set":var a={},r=[];return Object.keys(n).forEach((function(e){var t=n[e];a["".concat(t.row,"_").concat(t.col)]=t.id,r.push(t.id)})),Object(d.a)(Object(d.a)({},t.data),{},{board:a,gemsKeys:r});case"update":return Object.keys(n).forEach((function(t){var a=n[t];if(void 0===e[t]&&t.indexOf("gem-")>-1)return e.board["".concat(a.row,"_").concat(a.col)]=a.id,e.gemsKeys.push(a.id),void(e[t]=a);null!=a.row&&null!=a.col&&(e[t].row=a.row,e[t].col=a.col,e.board["".concat(a.row,"_").concat(a.col)]=t),a.destroyed&&(e[t].destroyed=a.destroyed)})),Object(d.a)({},e);case"cleanup":return e.gemsKeys.forEach((function(t){e[t]&&e[t].destroyed&&delete e[t]})),Object.keys(e.board).forEach((function(t){t.indexOf("-")>-1&&delete e.board[t]})),e.gemsKeys=e.gemsKeys.filter((function(t){return e[t]})),Object(d.a)({},e);default:throw new Error}},h=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(t.type){case"increment":return e+t.value;case"reset":return 0;default:return e}},g=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(t.type){case"increment":return{match3:(e.match3||0)+(t.data.match3||0),match4:(e.match4||0)+(t.data.match4||0),match5:(e.match5||0)+(t.data.match5||0)};case"reset":default:return{}}},f=n(2),p=0,j=function(e){var t=e.row,n=e.col,a=e.selection,r=e.board,o=function(e){return Array.isArray(e)?e[Math.floor(Math.random()*e.length)]:Math.floor(Math.random()*e)}(a),c="gem-".concat(p+=1);return r&&(r["".concat(t,"_").concat(n)]=c),{id:c,value:o,row:t,col:n}},b=function(e){for(var t=e.rowCount,n=e.colCount,a=e.typeCount,r=e.rowOffset,o=void 0===r?0:r,c=e.colOffset,s=void 0===c?0:c,i={},u={},l=0;l<t;l++)for(var d=0;d<n;d++){var m=[],h=[];if(d>1){var g=u["".concat(l,"_").concat(d-1)],f=u["".concat(l,"_").concat(d-2)];m=[i[g].value,i[f].value]}if(l>1){var p=u["".concat(l-1,"_").concat(d)],b=u["".concat(l-2,"_").concat(d)];h=[i[p].value,i[b].value]}for(var v=[m[0]===m[1]?m[0]:null,h[0]===h[1]?h[0]:null],y=[],O=0;O<a;O++)O!==v[0]&&O!==v[1]&&y.push(O);var x=j({row:l,col:d,selection:y,board:u});x.row+=o,x.col+=s,i[x.id]=x}return i};function v(e,t){var n=this;return function(a,r){return n.setState(Object(f.a)({},e,t(n.state[e],a)),r)}}var y=function(e){return((e||0)/1e3).toFixed(1)},O=function(e){return e.toLocaleString("en-us")},x=function(e){Object(i.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).initGameParameters=function(e){r.rowCount=Math.max(e.rowCount||8,3),r.colCount=Math.max(e.colCount||8,3),r.typeCount=Math.max(e.typeCount||5,3),r.targetScore=e.targetScore||2e4,r.timeLimit=1e3*(e.timeLimit||60),r.highscore=parseInt(localStorage.getItem("highscore")||0),r.soundManager=function(){var e=parseFloat(localStorage.getItem("volume")||.5),t="/space-gems",n=["Ethereal Eternity","Piano at Night","Space Harmony"],a=Math.floor(Math.random()*n.length);return["5secondsleft","congratulations","ding","gameover","gamestart","timesup"].forEach((function(e){new Audio("".concat(t,"/sfx/").concat(e,".mp3")).preload=!0})),{playBgm:function r(){var o=n[a];o.play||((o=new Audio("".concat(t,"/music/").concat(o,".mp3"))).onended=function(){a=a+1===a.lenght?0:a+1,r()},n[a]=o),o.volume=e,o.play()},pauseBgm:function(){n[a].pause&&n[a].pause()},setVolume:function(t){n[a].play&&(n[a].volume=t),e=t,localStorage.setItem("volume",t)},getVolume:function(){return e},playSfx:function(n){var a=new Audio("".concat(t,"/sfx/").concat(n,".mp3"));a.volume=2*e,a.play()}}}()},r.initDispatchers=function(){r.dispatchGems=v.call(Object(s.a)(r),"gems",m),r.dispatchScore=v.call(Object(s.a)(r),"score",h),r.dispatchStats=v.call(Object(s.a)(r),"stats",g)},r.initSetterGetters=function(){r.getGem=function(e){return r.state.gems["selectedGem"===e?r.selectedGemId:e]},r.getGemFromBoard=function(e,t){return r.getGem(r.state.gems.board["".concat(e,"_").concat(t)])},r.setSelectedGem=function(e){return r.selectedGemId=e},r.getRemainingTime=function(){return r.state.remainingTime},r.setRemainingTime=function(e,t){return r.setState({remainingTime:e},t)},r.isLocked=function(){return"default"!==r.getStep()},r.isWin=function(){return r.getTotalElapsed()<r.timeLimit?null:r.state.score>=r.targetScore},r.getPage=function(){return r.state.page},r.setPage=function(e){r.setState({page:e}),"startPage"!==e&&r.soundManager.playBgm()},r.getStep=function(){return r.state.step},r.setStep=function(e){return r.setState({step:e})},r.getUndo=function(){return r.undo},r.setUndo=function(e,t){return r.undo=e?{firstGemId:e,secondGemId:t}:null},r.getTotalElapsed=function(){return r.totalElapsed},r.setTotalElapsed=function(e){return r.totalElapsed=e},r.getLastTimestamp=function(){return r.lastTimestamp},r.setLastTimestamp=function(e){return r.lastTimestamp=e},r.getBgmVolume=r.soundManager.getVolume,r.setBgmVolume=r.soundManager.setVolume},r.initLifecycleStages=function(){r.startCountDown=function(e){var t=e.timeLimit,n=e.setRemainingTime,a=e.setTotalElapsed,r=e.setLastTimestamp,o=e.getPage,c=e.getTotalElapsed,s=e.getLastTimestamp,i=e.soundManager,u=!1,l=function e(){var l=s(),d=c();if(!(d&&d>=t)){if("playingPage"!==o())return r(null);var m=performance.now();d||l||(u=!1),d||(d=0),l||(l=m),d+=m-l,l=m;var h=Math.max(t-d,0);!u&&h<=5500&&(i.playSfx("5secondsleft"),u=!0),a(d),r(l),n(h,(function(){return requestAnimationFrame(e)}))}};return function(){return requestAnimationFrame(l)}}(Object(s.a)(r)),r.startGame=function(e){var t=e.rowCount,n=e.colCount,a=e.typeCount,r=e.dispatchGems,o=e.setStep,c=e.startCountDown,s=e.soundManager;return function(){r({type:"update",data:b({rowCount:t,colCount:n,typeCount:a,rowOffset:-t})}),o("create"),setTimeout((function(){s.playSfx("gamestart"),requestAnimationFrame(c)}),150+35*t*n)}}(Object(s.a)(r)),r.prepareNewGame=function(){r.setSelectedGem(null),r.setUndo(null),r.setTotalElapsed(null),r.setLastTimestamp(null),r.dispatchGems({type:"set",data:{}}),r.dispatchScore({type:"reset"}),r.dispatchStats({type:"reset"}),r.setStep("starting"),r.setPage("playingPage"),r.setRemainingTime(r.timeLimit)},r.swapGems=function(e){var t=e.getGem,n=e.setStep,a=e.dispatchGems,r=e.setUndo;return function(e,o,c){var s,i=t(e),u=t(o);a({type:"update",data:(s={},Object(f.a)(s,e,{row:u.row,col:u.col}),Object(f.a)(s,o,{row:i.row,col:i.col}),s)}),c&&r(null),n(c?"unswap":"swap")}}(Object(s.a)(r)),r.findMatches=function(e){var t=e.getGemFromBoard,n=e.rowCount,a=e.colCount;return function(){for(var e=[],r=0;r<2;r++)for(var o=0;o<(0===r?n:a);o++){for(var c=[],s=null,i=0;i<(0===r?a:n);i++){var u=t(0===r?o:i,0===r?i:o);u.value!==s||u.destroyed?c.push([u.id]):c[c.length-1].push(u.id),s=u?u.value:null}c.forEach((function(t){t.length>=3&&e.push(t)}))}return e}}(Object(s.a)(r)),r.destroyGems=function(e){var t=e.setStep,n=e.dispatchScore,a=e.dispatchGems,r=e.dispatchStats,o=e.soundManager;return function(e){var c={},s={match3:0,match4:0,match5:0},i=0;e.forEach((function(e){i+=(e.length-2)*e.length*100,s["match".concat(e.length)]+=1,e.forEach((function(e){c[e]={destroyed:!0}}))})),n({type:"increment",value:i}),a({type:"update",data:c}),r({type:"increment",data:s}),o.playSfx("ding"),t("destroy")}}(Object(s.a)(r)),r.replaceDestroyedGems=function(e){var t=e.getGemFromBoard,n=e.setStep,a=e.dispatchGems,r=e.rowCount,o=e.colCount,c=e.typeCount;return function(){for(var e={},s=0;s<o;s++)for(var i=0,u=r-1;u>=0;u--){var l=t(u,s);if(!l||l.destroyed){var d=j({row:-1*(i+=1),col:s,selection:c});e[d.id]=d}}a({type:"update",data:e}),n("create")}}(Object(s.a)(r)),r.dropGems=function(e){var t=e.getGemFromBoard,n=e.setStep,a=e.dispatchGems,r=e.rowCount,o=e.colCount;return function(){for(var e={},c=0;c<o;c++)for(var s=0,i=r,u=r-1;i>0;u--){var l=t(u,c);l&&!l.destroyed?(s>0&&(e[l.id]={row:l.row+s,col:l.col}),i-=1):s+=1}a({type:"update",data:e}),n("drop")}}(Object(s.a)(r)),r.cleanupGems=function(e){var t=e.dispatchGems;return function(){t({type:"cleanup"})}}(Object(s.a)(r)),r.next=function(e){var t=e.getStep,n=e.setStep,a=e.startGame,r=e.findMatches,o=e.swapGems,c=e.getUndo,s=e.destroyGems,i=e.replaceDestroyedGems,u=e.dropGems,l=e.cleanupGems;return function(){var e=t(),d=c();if("starting"===e)return a();"drop"===e&&l();var m=[];return"swap"!==e&&"drop"!==e||(m=r()),"swap"===e&&0===m.length&&d?o(d.firstGemId,d.secondGemId,!0):0!==m.length?s(m):"destroy"===e?i():"create"===e?u():void n("default")}}(Object(s.a)(r))},r.initUserEventHandlers=function(){r.handleGemMouseDown=function(e){var t=e.isLocked,n=e.setSelectedGem;return function(e){t()||n(e)}}(Object(s.a)(r)),r.handleGemMouseEnter=function(e){var t=e.getGem,n=e.setSelectedGem,a=e.setUndo,r=e.swapGems;return function(e){var o=t("selectedGem");if(o){var c=t(e);Math.abs(o.row-c.row)+Math.abs(o.col-c.col)===1?(a(o.id,c.id),r(o.id,c.id),n(null)):n(null)}}}(Object(s.a)(r)),r.handleChangePage=function(e){var t=e.prepareNewGame,n=e.setPage;return function(e){if("newPlayingPage"===e)return t();n(e)}}(Object(s.a)(r)),r.handleTouchMove=function(e){var t=e.getGem,n=e.handleGemMouseEnter;return function(e){var a=document.elementFromPoint(e.touches[0].clientX,e.touches[0].clientY),r=t("selectedGem");r&&a&&r.id!==a.id&&n(a.id)}}(Object(s.a)(r))},r.initPages=function(){r.startPage=function(e){var t=e.handleChangePage,n=e.targetScore,r=e.timeLimit;return function(){return Object(a.jsxs)("section",{id:"intro",children:[Object(a.jsx)("h1",{children:"Intro"}),Object(a.jsx)("p",{children:"Greetings! You were exploring a nice planet when aliens boarded your ship!"}),Object(a.jsxs)("p",{children:["After a chain of bizarre events, you now find yourself in a situation where you have"," ",Object(a.jsxs)("b",{children:[r/1e3," seconds "]}),"to ",Object(a.jsxs)("b",{children:["score ",O(n)," points"]})," in a tile-matching game over relaxing ambient music if you want to save your ship and crew."]}),Object(a.jsx)("button",{onClick:function(){return t("newPlayingPage")},children:"Start Game"})]})}}(Object(s.a)(r)),r.playingPage=function(e){var t=e.timeLimit,n=e.getRemainingTime,r=e.handleGemMouseDown,o=e.handleGemMouseEnter,c=e.handleTouchMove,s=e.setSelectedGem,i=e.handleChangePage;return function(e){var u=e.gems,l=e.score,d=n(),m=u.gemsKeys.map((function(e,n,c){var s=c[c.length-1-n];if(!u[s])return null;var i=u[s],l=i.value,m=i.row,h=i.col,g=i.destroyed,f={transform:"translate3d(".concat(100*h,"%, ").concat(100*m,"%, 0)")};return d===t&&(f.transitionDelay="".concat(35*n/1e3,"s")),g&&(f.transform+=" scale(0)"),Object(a.jsx)("span",{id:s,className:"gem",style:f,onMouseDown:function(){return r(s)},onMouseEnter:function(){return o(s)},onTouchStart:function(){return r(s)},"data-value":l,children:l},s)})),h=d<5e3,g=y(d).split(".");return Object(a.jsxs)("section",{id:"game",children:[Object(a.jsxs)("div",{className:"top-bar",children:[Object(a.jsxs)("span",{className:"score",children:["Score ",Object(a.jsx)("b",{children:O(l)})]}),Object(a.jsx)("span",{className:"menu",children:Object(a.jsx)("button",{onClick:function(){return i("menuPage")},children:"Menu"})}),Object(a.jsxs)("span",{className:"time",style:{color:h?"red":""},children:["Time"," ",Object(a.jsxs)("b",{children:[g[0],Object(a.jsx)("small",{children:g[1]})]})]})]}),Object(a.jsx)("div",{className:"board",onMouseUp:function(){return s(null)},onMouseLeave:function(){return s(null)},onTouchMove:c,children:m}),Object(a.jsx)("div",{className:"time-s-up",style:{display:d?"none":""},children:"Time's up!"})]})}}(Object(s.a)(r)),r.menuPage=function(e){var t=e.handleChangePage,n=e.targetScore,r=e.getRemainingTime,o=e.isWin,c=e.getBgmVolume,s=e.setBgmVolume;return function(e){var i=e.score,u=e.highscore,l=e.stats,d=r(),m=o(),h=null===m?"Game Paused":m?"Congratulations!":"You lost";return Object(a.jsx)("section",{id:"menu",children:Object(a.jsxs)("div",{children:[Object(a.jsx)("h1",{children:h}),null===m&&Object(a.jsxs)("div",{children:["Time Left: ",Object(a.jsxs)("b",{children:[y(d),"s"]})]}),Object(a.jsxs)("div",{children:["Target Score: ",Object(a.jsx)("b",{children:O(n)})]}),Object(a.jsxs)("div",{children:["Your Score: ",Object(a.jsx)("b",{children:O(i)})]}),Object(a.jsxs)("div",{children:["High Score: ",Object(a.jsx)("b",{children:O(u)})]}),Object(a.jsxs)("div",{className:"button-container",children:[Object(a.jsx)("button",{onClick:function(){return t("newPlayingPage")},children:"New Game"}),null===m&&Object(a.jsx)("button",{onClick:function(){return t("playingPage")},children:"Resume Game"})]}),Object(a.jsxs)("div",{children:["Volume:",Object(a.jsx)("input",{type:"range",defaultValue:c(),onInput:function(e){return s(e.target.value)},min:"0",max:"0.5",step:"0.05"})]}),Object(a.jsxs)("div",{className:"stats-container",children:[Object(a.jsx)("b",{children:"Stats This Round:"}),Object(a.jsxs)("div",{children:["3 of a Kind: ",l.match3||0]}),Object(a.jsxs)("div",{children:["4 of a Kind: ",l.match4||0]}),Object(a.jsxs)("div",{children:["5 of a Kind: ",l.match5||0]})]}),Object(a.jsx)("div",{className:"button-container",children:Object(a.jsx)("button",{onClick:function(){return t("creditsPage")},children:"Credits"})})]})})}}(Object(s.a)(r)),r.creditsPage=function(e){var t=e.handleChangePage;return function(){return Object(a.jsxs)("section",{id:"credits",children:[Object(a.jsx)("h1",{children:"Credits"}),Object(a.jsxs)("ul",{children:[Object(a.jsxs)("li",{children:['The music "Ethereal Eternity", "Piano at Night" and "Space Harmony" by'," ",Object(a.jsx)("a",{href:"https://www.purple-planet.com/",target:"_blank",rel:"noopener noreferrer",children:"Purple Planet Music"})," ","used under the"," ",Object(a.jsx)("a",{href:"https://creativecommons.org/licenses/by/3.0/",target:"_blank",rel:"noopener noreferrer",children:"Creative Commons Attribution License 3.0"}),"."]}),Object(a.jsxs)("li",{children:['The background image "Landscape Mountains Sun" by'," ",Object(a.jsx)("a",{href:"https://pixabay.com/users/8385-8385/",target:"_blank",rel:"noopener noreferrer",children:"Reimund Bertrams"})," ","used under the"," ",Object(a.jsx)("a",{href:"https://pixabay.com/service/license/",target:"_blank",rel:"noopener noreferrer",children:"Pixabay License"}),"."]})]}),Object(a.jsx)("div",{className:"button-container",children:Object(a.jsx)("button",{onClick:function(){return t("menuPage")},children:"Back to Menu"})})]})}}(Object(s.a)(r))},r.render=function(){return r[r.getPage()]({gems:r.state.gems,score:r.state.score,highscore:r.highscore,targetScore:r.targetScore,stats:r.state.stats})},r.initGameParameters(e),r.state={page:"startPage"},r.initDispatchers(),r.initSetterGetters(),r.initLifecycleStages(),r.initUserEventHandlers(),r.initPages(),r}return Object(c.a)(n,[{key:"componentWillUnmount",value:function(){this.soundManager.pause()}},{key:"componentDidUpdate",value:function(e,t){var n=this,a=this.getStep(),r=this.getPage();a!==t.step&&"default"!==a&&("create"===a||"starting"===a?requestAnimationFrame(this.next):setTimeout((function(){return requestAnimationFrame(n.next)}),150)),r!==t.page&&"playingPage"===r&&"starting"!==a&&this.startCountDown(),(this.state.remainingTime!==t.remainingTime||a!==t.step)&&this.state.remainingTime<=0&&"default"===a&&(this.state.score>this.highscore&&(this.highscore=this.state.score,localStorage.setItem("highscore",this.state.score)),this.soundManager.playSfx("timesup"),setTimeout((function(){n.isWin()?n.soundManager.playSfx("congratulations"):n.soundManager.playSfx("gameover"),n.handleChangePage("menuPage")}),1500))}}]),n}(l.Component);Object(r.hydrate)(Object(a.jsx)(x,{}),document.getElementById("root"))}},[[17,1,2]]]);
//# sourceMappingURL=main.58db9932.chunk.js.map